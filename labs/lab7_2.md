# Лабораторная работа №7.2

Знакомство с основными средствами администрирования UNIX-подобных систем на примере дистрибутива Ubuntu Server.
Сценарии (продолжение)

# Параметры сценария

Сценарий командной оболочки `bash` может принимать параметры. Нумерация, которую вы можете увидеть в сценарии ниже, может быть продолжена, если для работы сценария необходимо большее количество параметров. Также в вашем распоряжении имеются специальные параметры, содержащие значения, которые соответствуют количеству параметров, их строковому представлению, а также идентификатору процесса и последнему коду завершения процесса. Полный список специальных параметров размещен на странице руководства командной оболочки `bash`.

``` bash
#!/bin/bash
echo Первым аргументом является $1
echo Вторым аргументом является $2
echo Третьим аргументом является $3
echo \$ $$  - идентификатор процесса (PID) интерпретатора сценария
echo \# $#  - количество аргументов
echo \? $?  - последний код завершения процесса
echo \* $*  - строковое представление всех аргументов
```

> ## _Задание_:
>
> 1. Создайте сценарий в редакторе vim, поместите в него вышеприведенный код. Название ваш сценарий по вашему усмотрению.
> 2. Сделайте ваш файл сценария исполняемым (см. Л.Р.№7.1).
> 3. Запустите созданный скрипт с передачей параметров `./{название скрипта} {первый параметр} {второй параметр} {третий параметр}`, скриншот вывода поместите в отчет.

## Обход списка параметров

Оператор обхода списка параметров `shift` позволяет произвести разбор всех переданных сценарию параметров по очереди. Ниже представлен пример сценария с данным оператором.

``` bash
#!/bin/bash                                
                                          
if [ "$#" == "0" ] 
 then
  echo Вы должны передать по крайней мере один параметр сценарию.
  exit 1
fi

while (( $# ))
 do
  echo Вы передали сценарию параметр $1
  shift
 done
```

> ## _Задание_:
>
> 1. Создайте сценарий в редакторе vim, поместите в него вышеприведенный код. Название ваш сценарий по вашему усмотрению.
> 2. Сделайте ваш файл сценария исполняемым (см. Л.Р.№7.1).
> 3. Запустите созданный скрипт с передачей различного количества параметров. Запустите сценарий командной оболочки с одним параметром, с тремя параметрами, без параметров. Скриншоты вывода каждого запуска поместите в отчет.

## Ввод в процессе исполнения сценария

Вы можете попросить пользователя ввести данные, воспользовавшись командой `read` в сценарии.

```bash
#!/bin/bash
echo -n Введите число:
read number
```

## Задействование файла конфигурации

Команда `source` может также использоваться для задействования файла конфигурации сценария.

Ниже приведено содержимое демонстрационного файла конфигурации для приложения (`myApp.conf`):

```conf
# Файл конфигурации для приложения myApp

# Путь 
myAppPath=/var/myApp

# Количество приложений, осуществляющих саморепликацию
quines=5
```

А это код приложения, которое использует данный файл (`myApp.bash`):

```bash
#!/bin/bash
#
# Добро пожаловать в приложение myApp
# 

. ./myApp.conf

echo Количество самовоспроизводящихся приложений: $quines
```

В ходе исполнения приложение может использовать значения из подключенного файла конфигурации.

> ## _Задание_:
>
> 1. Создайте сценарий с названием `myApp.bash` в редакторе vim, поместите в него вышеприведенный код.
> 2. Сделайте ваш файл сценария исполняемым (см. Л.Р.№7.1).
> 3. Создайте файл конфигурации с названием `myApp.conf` в редакторе vim, поместите в него вышеприведенную конфигурацию. Поменяйте значение переменной `quines` на произвольное число.
> 4. Запустите сценарий. Скриншот вывода поместите в отчет.

## Получение параметров сценария с помощью функции `getopts`

Функция `getopts` позволяет осуществлять разбор параметров, передаваемых сценарию посредством командного интерфейса системы. Следующий сценарий позволяет использовать любую комбинацию параметров `a`, `f` и `z`.

```bash
#!/bin/bash

while getopts ":af:z" option;
do
 case $option in
  a)
   echo принят параметр -a
   ;;
  f)
   echo принят параметр -f с аргументом $OPTARG
   ;;
  z)
   echo принят параметр -z
   ;;
  :)
   echo "вместе с параметром -$OPTARG должен быть передан аргумент"
   ;;
  *)
   echo "некорректный параметр -$OPTARG" 
   ;;
 esac
done
```

> ## _Задание_:
>
> 1. Создайте сценарий в редакторе vim, поместите в него вышеприведенный код. Название ваш сценарий по вашему усмотрению.
> 2. Сделайте ваш файл сценария исполняемым (см. Л.Р.№7.1).
> 3. Запустите созданный скрипт с передачей различных параметров. Передайте сначала только корректные параметры (`-a`, `-f`, `-z`). Обратите внимание, что с параметром `-f` необходимо передавать аргумент (аргументы передаются через пробел после параметра). Затем передайте некорректные параметры (любые другие). Скриншоты вывода поместите в отчет.

# Дополнительные команды, используемые в сценариях

## Команда `eval`

Команда `eval` позволяет интерпретировать переданные аргументы как директивы сценария командной оболочки (результирующие команды исполняются). Данное обстоятельство позволяет использовать значение переменной в качестве переменной.

> ## _Задание_:
>
> Замените значение, передаваемое переменной `answer` на проивзольное число. Выполните следующие команды:
> 
> ```bash
> answer=42
> word=answer
> eval "y=\$$word" ; echo $y
> ```
> 
> Скриншот вывода поместите в отчет.

## Оператор `(( ))`

Оператор `(( ))` позволяет сравнивать числовые значения.

Пример:

```bash
(( 42 > 33 )) && echo true || echo false
(( 42 > 1201 )) && echo true || echo false
var42=42
(( 42 == var42 )) && echo true || echo false
(( 42 == $var42 )) && echo true || echo false
var42=33
(( 42 == var42 )) && echo true || echo false
```

## Команда `let`

Встроенная команда командной оболочки `let` инструктирует командную оболочку о необходимости вычисления значений арифметических выражений. Она будет возвращать значение 0, если результат последней арифметической операции не равен 0.

Пример:

```bash
let x="3 + 4" ; echo $x
let x="10 + 100/10" ; echo $x
let x="10-2+100/10" ; echo $x
let x="10*2+100/10" ; echo $x
```

Команда `let` также может использоваться для перевода значений в различные системы счисления.

Пример:

```bash
let x="0xFF" ; echo $x
let x="0xC0" ; echo $x
let x="0xA8" ; echo $x
let x="8#70" ; echo $x
let x="8#77" ; echo $x
let x="16#c0" ; echo $x
```

> ## _Задание_:
>
> Выполните команды из приведенных выше примеров использованя команды `let`. Ознакомьтесь с принципами работы этой команды. Никаких скриншотов помещать в отчет НЕ нужно :)

## Оператор `case`

В некоторых случаях вы можете упростить конструкции из вложенных условных переходов `if`, воспользовавшись конструкцией `case`.

```bash
#!/bin/bash
#
# Советы по обращению с дикими животными
#
echo -n "Какое животное вы видите ? "
read animal
case $animal in
        "лев" | "тигр")
                echo "Лучше всего быстро убегать!"
        ;;
        "кот")
                echo "Выпустите мышь..."
        ;;
        "собака")
                echo "Не беспокойтесь, угостите ее печеньем."
        ;;
        "курица" | "гусь" | "утка" )
                echo "Яйца на завтрак!"
        ;;
        "лигр")
                echo "Подойдите и скажите: 'Ах ты, большой пушистый котенок...'."
        ;;
        "вавилонская рыбка")
                echo "Она выпала из вашего уха ?"
        ;;
        *)
                echo "Вы обнаружили неизвестное животное, дайте ему имя!"
        ;;
esac
```

> ## _Задание_:
>
> 1. Создайте сценарий в редакторе vim, поместите в него вышеприведенный код. Название ваш сценарий по вашему усмотрению.
> 2. Сделайте ваш файл сценария исполняемым (см. Л.Р.№7.1).
> 3. Запустите созданный скрипт. Ознакомьтесь с результами работы конструкции `case`. Никаких скриншотов помещать в отчет НЕ нужно :)

## Функции сценариев командной оболочки

Функции сценариев командной оболочки могут использоваться для логической группировки команд.

Пример:

```bash
#!/bin/bash
                                          
function greetings {
echo Hello World!
echo а также приветствуем пользователя $USER!
}

echo Сейчас мы вызовем функцию
greetings
echo Конец
```

Функция сценария командной оболочки также может принимать параметры.

Пример:

```bash
#!/bin/bash

function plus {
let result="$1 + $2"
echo  $1 + $2 = $result
}

plus 3 10
plus 20 13
plus 20 22
```